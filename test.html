<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表格测试</title>
    <style>
        table { border-collapse: collapse; }
        td { border: 1px solid #ccc; padding: 10px; text-align: center; min-width: 40px; cursor: pointer; }
        td:hover { background-color: #f0f0f0; }
        .killed { background-color: #ffcccc; }
    </style>
</head>
<body>
    <h1>表格生成测试</h1>
    <div id="status">加载中...</div>
    <table id="line-table">
        <tr>
            <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th>
            <th>I</th><th>J</th><th>K</th><th>L</th><th>M</th><th>N</th><th>O</th><th>P</th>
            <th>Q</th><th>R</th><th>S</th><th>T</th>
        </tr>
        <!-- 测试行 -->
        <tr>
            <td data-line="1">1</td>
            <td data-line="2">2</td>
            <td data-line="3">3</td>
            <td data-line="4">4</td>
            <td data-line="5">5</td>
            <td data-line="6">6</td>
            <td data-line="7">7</td>
            <td data-line="8">8</td>
            <td data-line="9">9</td>
            <td data-line="10">10</td>
            <td data-line="11">11</td>
            <td data-line="12">12</td>
            <td data-line="13">13</td>
            <td data-line="14">14</td>
            <td data-line="15">15</td>
            <td data-line="16">16</td>
            <td data-line="17">17</td>
            <td data-line="18">18</td>
            <td data-line="19">19</td>
            <td data-line="20">20</td>
        </tr>
    </table>

    <script type="module">
        console.log('测试页面开始');
        
        // 简化的表格管理器测试
        class SimpleTableManager {
            constructor() {
                this.rows = 20;
                this.cols = 20;
            }

            initializeTable(table) {
                console.log('开始初始化表格');
                const existingCells = table.querySelectorAll('td[data-line]');
                console.log(`现有单元格: ${existingCells.length}`);
                
                if (existingCells.length < 400) {
                    let lineNumber = existingCells.length + 1;
                    let currentRow = null;
                    let cellsInCurrentRow = 0;
                    
                    // 如果有测试行，获取当前行
                    if (existingCells.length > 0) {
                        const lastCell = existingCells[existingCells.length - 1];
                        currentRow = lastCell.parentElement;
                        cellsInCurrentRow = currentRow.children.length;
                    }
                    
                    // 生成剩余的单元格
                    for (let i = lineNumber; i <= 400; i++) {
                        // 如果需要新行
                        if (!currentRow || cellsInCurrentRow >= this.cols) {
                            currentRow = document.createElement('tr');
                            table.appendChild(currentRow);
                            cellsInCurrentRow = 0;
                        }
                        
                        const cell = document.createElement('td');
                        cell.textContent = i;
                        cell.dataset.line = i;
                        cell.addEventListener('click', () => {
                            cell.classList.toggle('killed');
                            console.log(`点击了单元格 ${i}`);
                        });
                        
                        currentRow.appendChild(cell);
                        cellsInCurrentRow++;
                    }
                }
                
                const finalCells = table.querySelectorAll('td[data-line]');
                console.log(`最终单元格数量: ${finalCells.length}`);
                document.getElementById('status').textContent = `表格生成完成，共 ${finalCells.length} 个单元格`;
            }
        }

        // 测试
        try {
            const table = document.getElementById('line-table');
            const manager = new SimpleTableManager();
            manager.initializeTable(table);
        } catch (error) {
            console.error('测试失败:', error);
            document.getElementById('status').textContent = '测试失败: ' + error.message;
        }
    </script>
</body>
</html>
